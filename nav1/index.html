<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YYDY777</title>
    <meta name="keywords" content="YYDY777, Bookmarks, Link Management, Export Bookmarks, Website Bookmarks">
    <meta name="description" content="YYDY777">
    <meta name="author" content="YYDY777">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
    <link rel="mask-icon" href="assets/favicon/favicon-32x32.png" color="#0b0b0f">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/tailwind.css">
    <link rel="stylesheet" href="css/styles.css">
    <style>

        
        /* 搜索图标和清除按钮样式 */
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        
        .clear-search-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            display: none;
        }
        
        .clear-search-btn.show {
            display: block;
        }

        /* 侧边栏响应式调整 */
        .sidebar-container {
            transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
        }
        
        /* 加载动画 */
        .loader {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 导航菜单样式 */
        #navigation {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #navigation li {
            position: relative;
            display: block; /* 确保每个菜单项占满一行 */
        }

        /* 子菜单容器样式 */
        #navigation li .submenu-container {
            margin-left: 0.5rem;
            margin-top: 0.25rem;
            display: none;
            border-left: 2px solid rgba(60, 184, 132, 0.3);
        }

        #navigation li .submenu-container.active {
            display: block; /* 激活时显示 */
        }

        /* 移除可能导致水平布局的样式 */
        #navigation li .submenu-container ul {
            display: block;
            width: 100%;
        }

        /* 面包屑样式 */
        #breadcrumbs {
            border-width: 1px 0;
            border-style: solid;
            border-color: rgb(17 24 39 / 0.1);
        }

        .dark #breadcrumbs {
            border-color: rgba(156, 163, 175, 0.2);
        }
        
        #search-input {
            left: -2rem;
        }
        
        /* 移动端样式 */
        @media (max-width: 1023px) {
            #pcSearchInput {
                width: 80%;
            }
            #search-input {
                left: 0rem;
            }

            .sidebar-container {
                position: fixed;
                z-index: 50;
                height: 100vh; /* 限制高度为屏幕高度 */
                width: 85%;
                max-width: 300px;
                transform: translateX(-100%);
                display: block !important;
                overflow-y: auto; /* 仅允许垂直滚动 */
                overflow-x: hidden; /* 禁止水平滚动 */
                -webkit-overflow-scrolling: touch; /* 平滑滚动 */
                box-sizing: border-box;
            }
            
            /* 确保所有子元素不超出容器宽度 */
            .sidebar-container * {
                max-width: 100%;
                box-sizing: border-box;
            }
            
            /* 导航文本过长时自动截断 */
            #navigation a {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: calc(100% - 40px); /* 预留图标的空间 */
                font-size: 15px;
            }
            
            /* 固定头部 */
            .sidebar-container .flex.p-0.h-16 {
                width: 100%;
                flex-shrink: 0;
            }
            
            /* 可滚动内容区域 */
            .sidebar-container .flex.flex-1.flex-col.overflow-y-auto {
                flex: 1;
                overflow-y: auto;
                overflow-x: hidden;
            }
            
            .sidebar-container.active {
                transform: translateX(0);
            }
            
            .sidebar-backdrop {
                display: none;
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
            }
            
            .sidebar-backdrop.active {
                display: block;
            }
            
            .main-content {
                transition: transform 0.3s ease-in-out;
            }
            
            .main-content.sidebar-open {
                transform: translateX(100%);
            }
            
            /* 移动端菜单项增大点击区域 */
            #navigation li {
                padding: 0.5rem;
            }
        }
    </style>
</head>

<body class="h-full dark:pintree-bg-gray-900 bg-white">
    <!-- 侧边栏背景遮罩 -->
    <div id="sidebar-backdrop" class="sidebar-backdrop"></div>

    <div>
        <!-- 共用侧边栏（PC和移动端） -->
        <div class="sidebar-container hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-60 lg:flex-col">
            <div class="flex flex-col border-r border-gray-200 dark:pintree-border-gray-800 bg-white px-4 h-full font-semibold dark:pintree-bg-gray-900">
                <!-- 固定头部 -->
                <div class="flex p-0 h-16 shrink-0 items-center border-b border-gray-200 dark:border-gray-700">
                    <img class="pl-2 h-8 w-auto" src="assets/logo.svg" alt="Pintree">
                    <a href="" class="ml-4 font-extrabold text-2xl dark:text-white">YYDY777</a>
                </div>
                <!-- 可滚动内容区域 -->
                <div class="flex flex-1 flex-col overflow-y-auto no-scrollbar p-1 cursor-pointer">
                    <div id="sidebar" class="flex flex-1 flex-col">
                        <ul id="navigation" class="space-y-1">
                            <!-- Navigation items will be inserted here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content lg:pl-60 dark:pintree-bg-gray-900 flex flex-col min-h-screen">
            <!-- 顶部导航栏 -->
            <div class="items-center justify-between sticky top-0 z-40 flex h-16 shrink-0 gap-x-4  border-gray-200 dark:pintree-border-gray-800 bg-white dark:pintree-bg-gray-900 px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8">
                <div class="h-full items-center flex flex-1 gap-x-4 self-stretch lg:gap-x-6 justify-between">
                    <div class="flex gap-x-4 justify-between">
                        <button id="open-sidebar-button" type="button" class="lg:hidden -m-2.5 p-2.5">
                            <span class="sr-only">Open sidebar</span>
                            <svg class="h-6 w-6 text-gray-900 dark:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                            </svg>
                        </button>
                        <a href="" class="flex items-center">
                            <img id="headerlogo" class="w-auto lg:hidden" src="assets/logo.svg" alt="Pintree">
                        </a>
                        <!-- 搜索框 -->
                        <div id="search-input" class="relative w-full lg:w-72 h-full items-center">
                            <svg class="search-icon pointer-events-none h-5 w-5 text-gray-400" viewBox="0 0 20 20"
                              fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd"
                                d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
                                clip-rule="evenodd"></path>
                            </svg>
                            <input id="pcSearchInput" type="search" class="text-sm text-gray-900 dark:text-gray-400 pr-8 h-full w-full border-0 focus:outline-none focus:ring-0 dark:pintree-bg-gray-900" placeholder="Search...">
                            <button id="pcClearSearchButton" class="clear-search-btn text-sm text-gray-500 rounded">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="relative">
                        <button id="themeToggleButton" type="button" aria-label="Switch theme" class="group rounded-full bg-white/90 px-3 py-2 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur transition dark:pintree-bg-gray-900 dark:ring-white/10 dark:hover:ring-white/20">
              <svg id="sunIcon" viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                aria-hidden="true"
                class="h-6 w-6 fill-zinc-100 stroke-zinc-500 transition group-hover:fill-zinc-200 group-hover:stroke-zinc-700 dark:hidden [@media(prefers-color-scheme:dark)]:fill-teal-50 [@media(prefers-color-scheme:dark)]:stroke-teal-500 [@media(prefers-color-scheme:dark)]:group-hover:fill-teal-50 [@media(prefers-color-scheme:dark)]:group-hover:stroke-teal-600">
                <path
                  d="M8 12.25A4.25 4.25 0 0 1 12.25 8v0a4.25 4.25 0 0 1 4.25 4.25v0a4.25 4.25 0 0 1-4.25 4.25v0A4.25 4.25 0 0 1 8 12.25v0Z">
                </path>
                <path
                  d="M12.25 3v1.5M21.5 12.25H20M18.791 18.791l-1.06-1.06M18.791 5.709l-1.06 1.06M12.25 20v1.5M4.5 12.25H3M6.77 6.77 5.709 5.709M6.77 17.73l-1.061 1.061"
                  fill="none"></path>
              </svg>
              <svg id="moonIcon" viewBox="0 0 24 24" aria-hidden="true"
                class="hidden h-6 w-6 fill-zinc-700 stroke-zinc-500 transition dark:block [@media(prefers-color-scheme:dark)]:group-hover:stroke-zinc-400 [@media_not_(prefers-color-scheme:dark)]:fill-teal-400/10 [@media_not_(prefers-color-scheme:dark)]:stroke-teal-500">
                <path
                  d="M17.25 16.22a6.937 6.937 0 0 1-9.47-9.47 7.451 7.451 0 1 0 9.47 9.47ZM12.75 7C17 7 17 2.75 17 2.75S17 7 21.25 7C17 7 17 11.25 17 11.25S17 7 12.75 7Z"
                  stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
                    </div>
                </div>
            </div>

            <!-- 主内容区 -->
            <main class="dark:pintree-bg-gray-900 flex-grow">
                <div class="sticky top-63 z-39">
                    <!-- 加载动画 -->
                    <div id="loading-spinner" class="flex justify-center items-center h-full">
                        <div class="loader ease-linear rounded-full border-2 border-t-2 border-gray-400 h-6 w-6"></div>
                    </div>

                    <!-- 面包屑导航 -->
                    <div id="breadcrumbs" class="px-6 text-sm text-gray-400 flex justify-between items-center">
                        <div id="breadcrumbs-path" class="">
                            <!-- Breadcrumbs will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- 书签容器 -->
                <div id="bookmarks" class="grid gap-6 p-6">
                    <!-- Bookmark cards will be inserted here -->
                </div>
            </main>

            <!-- 页脚 -->
            <footer class="bg-white w-full dark:pintree-bg-gray-900">
                <div class="mx-auto px-6 py-6 md:flex md:items-center md:justify-between lg:px-8">
                    <div class="flex justify-center space-x-6 md:order-2">
                        <a href="https://x.com/pintree_io" target="_blank" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">X</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M13.6823 10.6218L20.2391 3H18.6854L12.9921 9.61788L8.44486 3H3.2002L10.0765 13.0074L3.2002 21H4.75404L10.7663 14.0113L15.5685 21H20.8131L13.6819 10.6218H13.6823ZM11.5541 13.0956L10.8574 12.0991L5.31391 4.16971H7.70053L12.1742 10.5689L12.8709 11.5655L18.6861 19.8835H16.2995L11.5541 13.096V13.0956Z" />
              </svg>
                        </a>
                        <a href="https://yydy777.github.io/" target="_blank" class="text-gray-400 hover:text-gray-500">
                            <span class="sr-only">GitHub</span>
                            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd"
                  d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.0 0022 12.017C22 6.484 17.522 2 12 2z"
                  clip-rule="evenodd" />
              </svg>
                        </a>
                    </div>
                    <div class="mt-8 md:order-1 md:mt-0">
                        <p class="text-center text-xs leading-5 text-gray-500 dark:text-gray-400 flex justify-center items-center">
                            &copy; <span id="currentYear"></span>&nbsp;Built with
                            <a href="https://yydy777.github.io/" class="text-green-600 hover:text-green-500 flex items-center ml-1" target="_blank">
                                <svg width="10" height="12" viewBox="0 0 10 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1">
                  <g clip-path="url(#clip0_421_47774)">
                    <path d="M4.27777 9.11133H6.6111V12.0002L5.44444 10.8783L4.27777 12.0002V9.11133Z" fill="#FCB11E" />
                    <path
                      d="M9.05557 5.72222L5.22223 0L1.3889 5.72222H2.68634L0.444458 9.11111H10L7.75813 5.72222H9.05557Z"
                      fill="#2D9C6C" />
                  </g>
                  <defs>
                    <clipPath id="clip0_421_47774">
                      <rect width="9.55556" height="12" fill="white" transform="translate(0.444458)" />
                    </clipPath>
                  </defs>
                </svg> YYDY777
                            </a>
                        </p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 保存完整数据的全局变量
            let fullBookmarkData = null;
            
            // DOM元素缓存
            const elements = {
                openSidebarButton: document.getElementById('open-sidebar-button'),
                sidebarContainer: document.querySelector('.sidebar-container'),
                sidebarBackdrop: document.getElementById('sidebar-backdrop'),
                mainContent: document.querySelector('.main-content'),
                navigation: document.getElementById('navigation'),
                pcSearchInput: document.getElementById('pcSearchInput'),
                pcClearSearchButton: document.getElementById('pcClearSearchButton'),
                loadingSpinner: document.getElementById('loading-spinner'),
                bookmarks: document.getElementById('bookmarks'),
                breadcrumbsPath: document.getElementById('breadcrumbs-path'),
                themeToggleButton: document.getElementById('themeToggleButton'),
                sunIcon: document.getElementById('sunIcon'),
                moonIcon: document.getElementById('moonIcon'),
                currentYear: document.getElementById('currentYear')
            };

            // 侧边栏控制
            const openSidebar = () => {
                if (elements.sidebarContainer && elements.sidebarBackdrop && elements.mainContent) {
                    elements.sidebarContainer.classList.add('active');
                    elements.sidebarBackdrop.classList.add('active');
                    elements.mainContent.classList.add('sidebar-open');
                    document.body.style.overflow = 'hidden';
                    ensureNavigationLoaded();
                }
            };

            const closeSidebar = () => {
                if (elements.sidebarContainer && elements.sidebarBackdrop && elements.mainContent) {
                    elements.sidebarContainer.classList.remove('active');
                    elements.sidebarBackdrop.classList.remove('active');
                    elements.mainContent.classList.remove('sidebar-open');
                    document.body.style.overflow = '';
                }
            };

            // 确保导航项已加载
            function ensureNavigationLoaded() {
                if (elements.navigation && elements.navigation.children.length === 0 && fullBookmarkData) {
                    renderNavigation(fullBookmarkData || [], elements.navigation, true);
                }
            }

            // 事件绑定
            elements.openSidebarButton?.addEventListener('click', openSidebar);
            elements.sidebarBackdrop?.addEventListener('click', closeSidebar);

            // 搜索功能
            function searchBookmarks(query) {
                if (!fullBookmarkData) return;
                
                const results = searchInData(fullBookmarkData, query.toLowerCase());
                renderBookmarks(results, [{ title: 'Search Results', children: results }]);
                elements.pcClearSearchButton?.classList.add('show');
                closeSidebar();
            }

            function searchInData(data, query) {
                return data.reduce((results, item) => {
                    const isMatch = item.title?.toLowerCase().includes(query) || item.url?.toLowerCase().includes(query);
                    if (isMatch) results.push(item);
                    if (item.children) results.push(...searchInData(item.children, query));
                    return results;
                }, []);
            }

            function clearSearchResults() {
                if (!fullBookmarkData) return;
                
                const secondLayer = fullBookmarkData[0]?.children || fullBookmarkData;
                renderNavigation(secondLayer, elements.navigation);
                renderBookmarks(secondLayer, [{ title: 'Bookmark', children: secondLayer }]);
                elements.pcSearchInput.value = '';
                elements.pcClearSearchButton?.classList.remove('show');
            }

            // 搜索事件绑定
            elements.pcSearchInput?.addEventListener('input', (e) => {
                const query = e.target.value.trim();
                elements.pcClearSearchButton?.classList.toggle('show', !!query);
            });
            
            elements.pcSearchInput?.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && elements.pcSearchInput.value.trim()) {
                    searchBookmarks(elements.pcSearchInput.value.trim());
                }
            });

            elements.pcClearSearchButton?.addEventListener('click', clearSearchResults);

            // 创建书签卡片
            function createCard(title, url, icon) {
                const card = document.createElement('div');
                card.className = 'cursor-pointer flex items-center hover:shadow-sm transition-shadow p-4 bg-white shadow-sm ring-1 ring-gray-900/5 dark:pintree-ring-gray-800 rounded-lg hover:bg-gray-100 dark:pintree-bg-gray-900 dark:hover:pintree-bg-gray-800';

                // 限制协议处理
                const restrictedProtocols = ['chrome://', 'edge://', 'about:', 'file://'];
                const isRestricted = restrictedProtocols.some(protocol => url.startsWith(protocol));

                card.onclick = () => {
                    if (isRestricted) {
                        navigator.clipboard.writeText(url)
                            .then(() => showToast("已复制"))
                            .catch(err => {
                                console.error('复制失败:', err);
                                showToast("复制失败", true);
                            });
                    } else {
                        window.open(url, '_blank');
                    }
                };

                // 卡片图标
                const cardIcon = document.createElement('img');
                cardIcon.src = icon || 'assets/default-icon.svg';
                cardIcon.alt = title;
                cardIcon.className = 'w-8 h-8 mr-4 rounded-full flex-shrink-0 card-icon-bg';
                cardIcon.onerror = () => cardIcon.src = 'assets/default-icon.svg';

                // 卡片内容
                const cardContent = document.createElement('div');
                cardContent.className = 'flex flex-col overflow-hidden';

                const cardTitle = document.createElement('h2');
                cardTitle.className = 'text-sm font-medium mb-1 truncate dark:text-gray-400';
                cardTitle.innerText = title;

                const cleanUrl = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
                const cardUrl = document.createElement('p');
                cardUrl.className = 'text-xs text-gray-400 dark:text-gray-600 dark:hover:text-gray-400 truncate';
                cardUrl.innerText = cleanUrl;

                cardContent.append(cardTitle, cardUrl);
                card.append(cardIcon, cardContent);

                return card;
            }

            // 创建文件夹卡片
            function createFolderCard(title, children, path) {
                const card = document.createElement('div');
                card.className = 'folder-card text-gray rounded-lg cursor-pointer flex flex-col items-center';
                card.onclick = () => {
                    const newPath = [...path, { title, children }];
                    renderBookmarks(children, newPath);
                    updateSidebarActiveState(newPath);
                    closeSidebar();
                };

                const cardIcon = document.createElement('div');
                cardIcon.innerHTML = `
                    <svg viewBox="0 0 100 80" class="folder__svg">
                        <rect x="0" y="0" width="100" height="80" class="folder__back" />
                        <rect x="15" y="8" width="70" height="60" class="paper-1" />
                        <rect x="10" y="18" width="80" height="50" class="paper-2" />
                        <rect x="0" y="10" width="100" height="70" class="folder__front" />
                        <rect x="0" y="10" width="100" height="70" class="folder__front right" />
                    </svg>
                `;
                cardIcon.className = 'mb-2';

                const cardTitle = document.createElement('h2');
                cardTitle.className = 'text-xs font-normal text-center w-full truncate dark:text-gray-400';
                cardTitle.innerText = title;

                card.append(cardIcon, cardTitle);
                return card;
            }

            // 渲染导航菜单
            function renderNavigation(folders, container, isFirstRender = false, path = []) {
                if (!container) return;
                container.innerHTML = '';

                folders.forEach((folder, index) => {
                    if (folder.type !== 'folder') return;

                    // 创建主菜单项容器
                    const navItemWrapper = document.createElement('li');
                    navItemWrapper.className = 'mb-1';

                    // 创建标题行容器
                    const navItem = document.createElement('div');
                    navItem.className = 'group flex justify-between items-center rounded-md p-1 text-gray-700 dark:text-gray-400 hover:text-main-500 hover:bg-gray-50 dark:hover:pintree-bg-gray-800 transition-colors duration-150';

                    // 创建链接部分
                    const navLinkContainer = document.createElement('div');
                    navLinkContainer.className = 'flex items-center space-x-2 truncate flex-1 cursor-pointer';
                    navLinkContainer.addEventListener('click', (e) => {
                        e.stopPropagation();
                        renderBookmarks(folder.children || [], [...path, {
                            title: folder.title,
                            children: folder.children || []
                        }]);
                        if (window.innerWidth <= 1023) closeSidebar();
                    });

                    // 文件夹图标和名称
                    navLinkContainer.innerHTML = `
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7a2 2 0 012-2h4l2 2h7a2 2 0 012 2v7a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" />
                            </svg>
                        </span>
                        <a class="text-sm leading-6 font-semibold dark:text-gray-400 truncate">${folder.title}</a>
                    `;
                    
                    navItem.appendChild(navLinkContainer);

                    // 检查是否有有效子项
                    let hasValidChildren = false;
                    if (folder.children && Array.isArray(folder.children) && folder.children.length > 0) {
                        for (let i = 0; i < folder.children.length; i++) {
                            const item = folder.children[i];
                            if (item && (item.type === 'folder' || item.type === 'link')) {
                                hasValidChildren = true;
                                break;
                            }
                        }
                    }

                    // 添加展开图标和子菜单容器
                    if (hasValidChildren) {
                        const toggleIcon = document.createElement('span');
                        toggleIcon.className = 'ml-2 transform transition-transform duration-200 cursor-pointer flex-shrink-0 toggle-icon';
                        toggleIcon.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
                        `;
                        
                        const submenuContainer = document.createElement('div');
                        submenuContainer.className = 'submenu-container ml-6 mt-1 border-l-2 border-green-200 dark:border-green-900 pl-3';
                        
                        // 递归渲染子菜单
                        renderNavigation(folder.children, submenuContainer, false, [...path, { title: folder.title }]);
                        
                        // 绑定展开/收缩事件
                        toggleIcon.addEventListener('click', (e) => {
                            e.stopPropagation();
                            submenuContainer.classList.toggle('active');
                            toggleIcon.classList.toggle('rotate-90');
                        });
                        
                        navItem.appendChild(toggleIcon);
                        navItemWrapper.append(navItem, submenuContainer);

                        // 初始展开第一个文件夹
                        if (isFirstRender && index === 0) {
                            submenuContainer.classList.add('active');
                            toggleIcon.classList.add('rotate-90');
                        }
                    } else {
                        navItemWrapper.appendChild(navItem);
                    }

                    container.appendChild(navItemWrapper);
                });

                // 清理无效图标
                container.querySelectorAll('li').forEach(item => {
                    const toggleIcon = item.querySelector('.toggle-icon');
                    const submenu = item.querySelector('.submenu-container');
                    if (toggleIcon && (!submenu || submenu.children.length === 0)) {
                        toggleIcon.remove();
                    }
                });
            }

            // 渲染面包屑导航
            function renderBreadcrumbs(path) {
                if (!elements.breadcrumbsPath) return;
                elements.breadcrumbsPath.innerHTML = '';

                path.forEach((item, index) => {
                    const breadcrumb = document.createElement('span');
                    breadcrumb.className = 'cursor-pointer hover:underline bg-yydy';
                    breadcrumb.innerText = item.title;
                    breadcrumb.onclick = () => {
                        // 从完整数据中重新获取对应路径的内容
                        if (fullBookmarkData) {
                            const targetData = findDataByPath(fullBookmarkData, path.slice(0, index + 1));
                            renderBookmarks(targetData, path.slice(0, index + 1));
                            updateSidebarActiveState(path.slice(0, index + 1));
                            elements.pcClearSearchButton?.classList.remove('show');
                        }
                    };

                    elements.breadcrumbsPath.appendChild(breadcrumb);
                    if (index < path.length - 1) {
                        const separator = document.createElement('span');
                        separator.innerText = ' > ';
                        elements.breadcrumbsPath.appendChild(separator);
                    }
                });
            }
            
            // 根据路径从完整数据中查找对应内容
            function findDataByPath(data, path) {
                // 跳过第一个"Bookmark"节点
                let currentData = path[0]?.title === 'Bookmark' ? [...data] : data;
                
                // 从路径的第二个节点开始查找
                for (let i = path[0]?.title === 'Bookmark' ? 1 : 0; i < path.length; i++) {
                    const found = currentData.find(item => item.title === path[i].title);
                    if (!found) return [];
                    currentData = found.children || [];
                }
                return currentData;
            }

            // 更新侧边栏激活状态
            function updateSidebarActiveState(path) {
                let currentNav = elements.navigation;
                if (!currentNav) return;

                path.forEach((item, index) => {
                    currentNav.querySelectorAll('li').forEach(navItem => {
                        const navLink = navItem.querySelector('a');
                        if (navLink && navLink.innerText === item.title && index < path.length - 1) {
                            const submenu = navItem.querySelector('.submenu-container');
                            if (submenu) {
                                submenu.classList.add('active');
                                navItem.querySelector('.transform')?.classList.add('rotate-90');
                                currentNav = submenu;
                            }
                        }
                    });
                });
            }

            // 无结果提示
            function showNoResultsMessage() {
                if (!elements.bookmarks) return;
                elements.bookmarks.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m9-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h2 class="text-gray-500 text-xl font-semibold mt-4">Oops, Nothing to See Here!</h2>
                        <p class="text-gray-500 mt-2">Try another search or discover more cool stuff elsewhere!</p>
                    </div>
                `;
            }

            // 渲染书签
            function renderBookmarks(data, path) {
                if (!elements.bookmarks) return;
                elements.bookmarks.innerHTML = '';

                // 渲染面包屑
                renderBreadcrumbs(path);

                // 分离文件夹和链接
                const folders = (data || []).filter(item => item.type === 'folder');
                const links = (data || []).filter(item => item.type === 'link');

                // 无结果提示
                if (folders.length === 0 && links.length === 0) {
                    showNoResultsMessage();
                    return;
                }

                // 渲染文件夹
                if (folders.length > 0) {
                    const folderSection = document.createElement('div');
                    folderSection.className = 'grid grid-cols-3 sm:grid-cols-6 lg:grid-cols-8 2xl:grid-cols-12 gap-6';
                    folders.forEach(folder => folderSection.appendChild(createFolderCard(folder.title, folder.children, path)));
                    elements.bookmarks.appendChild(folderSection);
                }

                // 文件夹与链接之间添加分隔线
                if (folders.length > 0 && links.length > 0) {
                    const separator = document.createElement('hr');
                    separator.className = 'my-1 border-t-1 border-gray-200 dark:pintree-border-gray-800';
                    elements.bookmarks.appendChild(separator);
                }

                // 渲染链接
                if (links.length > 0) {
                    const linkSection = document.createElement('div');
                    linkSection.className = 'grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 2xl:grid-cols-6 gap-6';
                    links.forEach(link => linkSection.appendChild(createCard(link.title, link.url, link.icon)));
                    elements.bookmarks.appendChild(linkSection);
                }

                // 更新侧边栏激活状态
                updateSidebarActiveState(path);
            }

            // 悬浮提示函数
            function showToast(msg, error = false) {
                const toast = document.createElement('div');
                Object.assign(toast.style, {
                    position: 'fixed',
                    top: '20px',
                    left: '50%',
                    transform: 'translate(-50%, -100%)',
                    background: error ? '#c33' : '#4c9',
                    color: 'white',
                    padding: '8px 16px',
                    borderRadius: '4px',
                    fontSize: '14px',
                    opacity: '0',
                    transition: 'all 0.3s',
                    zIndex: '1000',
                    pointerEvents: 'none'
                });
                toast.textContent = msg;
                document.body.appendChild(toast);

                requestAnimationFrame(() => {
                    toast.style.opacity = '1';
                    toast.style.transform = 'translate(-50%, 0)';
                });

                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translate(-50%, -100%)';
                    setTimeout(() => document.body.removeChild(toast), 300);
                }, 1500);
            }

            // 主题切换逻辑
            function applyDarkTheme() {
                document.documentElement.classList.add('dark');
                elements.sunIcon?.classList.add('hidden');
                elements.moonIcon?.classList.remove('hidden');
            }

            function applyLightTheme() {
                document.documentElement.classList.remove('dark');
                elements.sunIcon?.classList.remove('hidden');
                elements.moonIcon?.classList.add('hidden');
            }

            function toggleTheme() {
                document.documentElement.classList.contains('dark') ? applyLightTheme() : applyDarkTheme();
            }

            elements.themeToggleButton?.addEventListener('click', toggleTheme);

            // 跟随系统主题
            const prefersDarkTheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
            (prefersDarkTheme ? applyDarkTheme : applyLightTheme)();

            // 监听系统主题变化
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (event) => {
                (event.matches ? applyDarkTheme : applyLightTheme)();
            });

            // 初始化数据加载
            fetch('json/pintree.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    // 保存完整数据
                    fullBookmarkData = [...data];
                    
                    // 隐藏加载动画
                    elements.loadingSpinner.style.display = 'none';

                    const firstLayer = data || [];
                    if (elements.navigation) renderNavigation(firstLayer, elements.navigation, true);

                    // 初始渲染书签
                    if (firstLayer.length > 0) {
                        const firstItem = firstLayer[0];
                        const initialPath = [
                            { title: 'Bookmark', children: firstLayer },
                            { title: firstItem.title, children: firstItem.children || [] }
                        ];
                        renderBookmarks(firstItem.children || [], initialPath);
                        updateSidebarActiveState(initialPath);
                    } else {
                        renderBookmarks([], [{ title: 'Bookmark', children: [] }]);
                    }
                })
                .catch(error => {
                    console.error('Error loading bookmarks:', error);
                    elements.loadingSpinner.style.display = 'none';
                    showNoResultsMessage();
                });

            // 年份自动更新
            elements.currentYear.textContent = new Date().getFullYear();

            // 窗口大小变化时处理
            window.addEventListener('resize', () => {
                if (window.innerWidth > 1023) {
                    // 桌面视图始终显示侧边栏
                    if (elements.sidebarContainer && elements.sidebarBackdrop && elements.mainContent) {
                        elements.sidebarContainer.classList.add('active');
                        elements.sidebarBackdrop.classList.remove('active');
                        elements.mainContent.classList.remove('sidebar-open');
                    }
                } else {
                    // 移动视图默认隐藏侧边栏
                    if (elements.sidebarContainer && elements.sidebarBackdrop && elements.mainContent) {
                        elements.sidebarContainer.classList.remove('active');
                        elements.sidebarBackdrop.classList.remove('active');
                        elements.mainContent.classList.remove('sidebar-open');
                    }
                }
            });

            // 初始化时根据窗口大小设置侧边栏状态
            if (window.innerWidth > 1023 && elements.sidebarContainer) {
                elements.sidebarContainer.classList.add('active');
            }
        });
    </script>
</body>

</html>
    
